- en: 02\. Introduction to Sockets
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 02\. 套接字简介
- en: This chapter is an introduction to socket programming. Readers are assumed to
    have basic knowledge of computer networking but no experience in network programming.
    This book does not contain every detail on how to use socket APIs, you are advised
    to read manpages and other network programming guides while learning from this
    book. ([https://beej.us/](https://beej.us/) is a good source for socket APIs.)
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章是关于套接字编程的介绍。假设读者具备计算机网络的基本知识，但没有网络编程经验。本书不包含使用套接字 API 的所有细节，建议你在学习本书的同时阅读手册页和其他网络编程指南。（[https://beej.us/](https://beej.us/)
    是学习套接字 API 的好资源。）
- en: Redis is an example of the server/client system. Multiple clients connect to
    a single server, and the server receives requests from TCP connections and sends
    responses back. There are several Linux system calls we need to learn before we
    can start socket programming.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Redis 是服务器/客户端系统的例子。多个客户端连接到单个服务器，服务器从 TCP 连接接收请求并返回响应。在我们开始套接字编程之前，需要学习几个 Linux
    系统调用。
- en: 'The `socket()` syscall returns an fd. Here is a rough explanation of “fd” if
    you are unfamiliar with Unix systems: An fd is an integer that refers to something
    in the Linux kernel, like a TCP connection, a disk file, a listening port, or
    some other resources, etc.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '`socket()` 系统调用返回一个文件描述符。如果你不熟悉 Unix 系统，以下是对“文件描述符”的简要解释：文件描述符是一个整数，它指向 Linux
    内核中的某个东西，比如 TCP 连接、磁盘文件、监听端口或其他资源等。'
- en: 'The `bind()` and `listen()` syscall: the `bind()` associates an address to
    a socket fd, and the `listen()` enables us to accept connections to that address.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '`bind()` 和 `listen()` 系统调用：`bind()` 将一个地址关联到套接字文件描述符，而 `listen()` 允许我们接受对该地址的连接。'
- en: 'The `accept()` takes a listening fd, when a client makes a connection to the
    listening address, the `accept()` returns an fd that represents the connection
    socket. Here is the pseudo-code that explains the typical workflow of a server:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '`accept()` 接受一个监听文件描述符，当客户端连接到监听地址时，`accept()` 返回一个表示连接套接字的文件描述符。以下是解释服务器典型工作流程的伪代码：'
- en: '[PRE0]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `read()` syscall receives data from a TCP connection. The `write()` syscall
    sends data. The `close()` syscall destroys the resource referred by the fd and
    recycles the fd number.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '`read()` 系统调用从 TCP 连接接收数据。`write()` 系统调用发送数据。`close()` 系统调用销毁由文件描述符引用的资源，并回收文件描述符编号。'
- en: 'We have introduced the syscalls needed for server-side network programming.
    For the client side, the `connect()` syscall takes a socket fd and address and
    makes a TCP connection to that address. Here is the pseudo-code for the client:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们介绍了服务器端网络编程所需的系统调用。对于客户端，`connect()` 系统调用接受一个套接字文件描述符和地址，并连接到该地址。以下是客户端的伪代码：
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The next chapter will help you get started using real code.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将帮助你开始使用真实代码。
