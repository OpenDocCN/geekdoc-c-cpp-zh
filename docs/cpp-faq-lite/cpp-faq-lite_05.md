# [7] 类和对象

# [7] 类和对象

## FAQs in section [7]:

*   7.1] 类是什么[？
*   [7.2] 对象是什么？
*   [7.3] 什么样的接口是“好”的？
*   [7.4] 封装是什么？
*   [7.5] C++是如何在安全性和可用性间取得平衡的？
*   [7.6] 我如何才能防止其它程序员查看我的类的私有部分而破坏封装？
*   [7.7] 封装是一种安全装置吗？
*   [7.8] 关键字 struct 和 class 有什么区别？

## 7.1 类是什么？

面向对象软件的基本组成物

类定义数据类型，就如同 C 中的结构。从计算机科学的角度来理解，类型由状态集合和转换这些状态的操作集合组成。因为 `int` 既有状态集合，也有象 `i + j` 或 `i++` 等这样的操作，所以 `int` 是一种类型。同样，类提供了一组操作集合（通常是 `public:` ）和一组描述类型实例所拥有的抽象值的数据集合。

可以将 `int` 看作为一个有 operator++ 等成员函数的类。（`int` 实际并不是一个类，但是基本类似：一个类是一种类型，就如同 `int` 是一种类型）

注意: C 程序员可以将类看作为成员默认为私有的结构。但是，如果那是你对类的全部认识，那么你可能要经历个人的思考模式的转变了。

## 7.2 对象是什么？

和语义有关的存储区域

当我们声明了`int i`，我们说：“`i` 是 `int` 类型的一个对象”。在 OO/C++ 中，“对象”通常意味着“类的一个实例”。因此，类定义多个对象（实例）的可能的行为。

## 7.3 什么样的接口是“良好”的？

提供了一个将“块”状的软件简化了的视图，并且以“用户”的词汇表达的接口。（“块”通常是一个或一组紧密相连的类；“用户”是指其它的开发者而不是最终客户）

*   “简化了的视图”指隐藏不必要的细节。这样可以减少用户的错误率。
*   “用户的词汇”意思是用户不需要学习新的词汇或概念，这样可以降低用户的学习曲线。

## 7.4 封装是什么？

防止未被授权地访问一些信息和功能。

节省成本的关键是从软件“块”的稳定部分中分离出可变的部分。封装给这个“块”安置了防火墙，它可以防止其它“块”访问可变的部分；其它“块”仅仅能够访问稳定的部分。这样做，当可变的部分改变后，可以防止其它“块”被破坏。在面向对象软件的概念中，“块(chunk)”通常指一个或一组紧密相连的类。

“可变的部分”是实现的细节。如果“块”是单个类，那么可变的部分通常用 `private:` 和/或 `protected:` 关键字来封装。如果“块”是一组紧密相连的类，封装可被用来拒绝对组中全部类的访问。继承。

“稳定的部分”是接口。好的接口提供了一个以用户的词汇简化了的视图，并且被从外到里的设计。（此处的“用户”是指其它开发者，而不是购买完整应用的最终用户）。如果“块”是单个类，接口仅仅是类的 public: 成员函数和友元，那么接口可以包括模块中的多个类。

设计一个清晰的接口并且将实现和接口分离，只不过是允许用户使用接口。而封装实现可以强迫用户使用接口。

## 7.5 C++是如何在安全性和可用性间取得平衡的？

在 C 中，封装是通过在编辑单元或模块中，将对象声明为静态来完成的。这样做防止了其他模块访问静态区域。（顺便说一句，现在这种做法是被遗弃的：不要在 C++中这样做）

不幸的是，由于没有对一个模块的静态数据产生多个实例的直接支持，这种处理方法不支持数据的多个实例。在 C 中如果需要多个实例，那么程序员一般使用结构。但是很不幸，C 的结构不支持封装。这增加了在安全性（信息隐藏）和可用性（多实例）之间取得平衡的难度。

在 C++中，你可以利用类来同时获得多实例和封装性。类的 public: 部分包含了类的接口，它们通常由类的 public: 成员函数和它的友元 部分包含了类的实现，而通常数据就在这里。

最终的结果就象是“封装了的结构”。这样就易于在安全性（信息隐藏）和可用性（多实例）间取得平衡。

## 7.6 我如何才能防止其它程序员查看我的类的私有部分而破坏封装？

不必这么做——封装是对于代码而言的，而不是对人。

只要其它程序员写的代码不依赖于他们的所见，那么即使它们看了你的类的 `private:` 和/或 `proteced:` 部分，也不会破坏封装。换句话说，封装不会 阻止人认识类的内部。封装只是防止他们写出依赖类内部实现的代码。你的公司不必为维护你眼睛所看到的东西支付维护成本，但是必须为维护你的指尖写出的代码支付维护成本。正如你知道的，倘若他们写的代码依赖于接口而不是实现，就不会增加维护成本。

此外，这很少成为一个问题。我想不会有故意试图访问类的私有部分的程序员。My recommendation in such cases would be to change the programmer, not the code" [James Kanze; used with permission].

## 7.7 封装是一种安全装置吗？

不。

封装 != 安全。

封装要防止的是错误，而不是间谍。

## 7.8 关键字 struct 和 class 有什么区别？

struct 的成员默认是公有的，而类的成员默认是私有的。注意：你应该明白地声明你的类成员为公有的、私有的、或者是保护的，而不是依赖于默认属性

struct 和 class 在其他方面是功能相当的。

OK，明晰的技术谈论够多了。从感情上讲，大多数的开发者感到类和结构有很大的差别。感觉上结构仅仅象一堆缺乏封装和功能的开放的内存位，而类就象活的并且可靠的社会成员，它有智能服务，有牢固的封装屏障和一个良好定义的接口。既然大多数人都这么认为，那么只有在你的类有很少的方法并且有公有数据（这种事情在良好设计的系统中是存在的!）时，你也许应该使用 struct 关键字，否则，你应该使用 class 关键字。