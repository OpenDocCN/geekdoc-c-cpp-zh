["```cpp\n[](#cb1-1)all_fds = [...]\n[](#cb1-2)while True:\n[](#cb1-3)    active_fds = poll(all_fds)\n[](#cb1-4)    for each fd in active_fds:\n[](#cb1-5)        do_something_with(fd)\n[](#cb1-6)\n[](#cb1-7)def do_something_with(fd):\n[](#cb1-8)    if fd is a listening socket:\n[](#cb1-9)        add_new_client(fd)\n[](#cb1-10)    elif fd is a client connection:\n[](#cb1-11)        while work_not_done(fd):\n[](#cb1-12)            do_something_to_client(fd)\n[](#cb1-13)\n[](#cb1-14)def do_something_to_client(fd):\n[](#cb1-15)    if should_read_from(fd):\n[](#cb1-16)        data = read_until_EAGAIN(fd)\n[](#cb1-17)        process_incoming_data(data)\n[](#cb1-18)    while should_write_to(fd):\n[](#cb1-19)        write_until_EAGAIN(fd)\n[](#cb1-20)    if should_close(fd):\n[](#cb1-21)        destroy_client(fd)\n```", "```cpp\n[](#cb2-1)static void fd_set_nb(int fd) {\n[](#cb2-2)    errno = 0;\n[](#cb2-3)    int flags = fcntl(fd, F_GETFL, 0);\n[](#cb2-4)    if (errno) {\n[](#cb2-5)        die(\"fcntl error\");\n[](#cb2-6)        return;\n[](#cb2-7)    }\n[](#cb2-8)\n[](#cb2-9)    flags |= O_NONBLOCK;\n[](#cb2-10)\n[](#cb2-11)    errno = 0;\n[](#cb2-12)    (void)fcntl(fd, F_SETFL, flags);\n[](#cb2-13)    if (errno) {\n[](#cb2-14)        die(\"fcntl error\");\n[](#cb2-15)    }\n[](#cb2-16)}\n```"]