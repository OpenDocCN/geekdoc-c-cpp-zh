- en: Tests
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tests
- en: 原文：[https://cel.cs.brown.edu/crp/etc/tests.html](https://cel.cs.brown.edu/crp/etc/tests.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://cel.cs.brown.edu/crp/etc/tests.html](https://cel.cs.brown.edu/crp/etc/tests.html)
- en: This chapter gives a small example of testing in Rust by comparison to [Boost.Test](https://github.com/boostorg/test)
    for C++. A more thorough guide to testing in Rust is available as part of the
    [Rust Book](https://doc.rust-lang.org/book/ch11-00-testing.html), including information
    on [documentation testing](https://doc.rust-lang.org/stable/book/ch14-02-publishing-to-crates-io.html#documentation-comments-as-tests).
    Details on the built-in support for testing in [rustc](https://doc.rust-lang.org/rustc/tests/index.html)
    and [Cargo](https://doc.rust-lang.org/cargo/commands/cargo-test.html) are available
    in their respective manuals.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章通过将 Rust 中的测试与 C++ 的 [Boost.Test](https://github.com/boostorg/test) 进行比较，提供了一个小的测试示例。关于
    Rust 中测试的更详细指南可以作为 [Rust Book](https://doc.rust-lang.org/book/ch11-00-testing.html)
    的一部分找到，包括有关 [文档测试](https://doc.rust-lang.org/stable/book/ch14-02-publishing-to-crates-io.html#documentation-comments-as-tests)
    的信息。关于 [rustc](https://doc.rust-lang.org/rustc/tests/index.html) 和 [Cargo](https://doc.rust-lang.org/cargo/commands/cargo-test.html)
    内置测试支持的详细信息可以在它们各自的手册中找到。
- en: '[Unit tests](#unit-tests)'
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[单元测试](#unit-tests)'
- en: When using C++ test frameworks such as Boost.Test, tests are defined as functions
    which are registered with the framework. The tests are compiled against a test
    driver provided by the framework.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用 C++ 测试框架，如 Boost.Test 时，测试被定义为与框架注册的函数。测试是针对框架提供的测试驱动程序编译的。
- en: In Rust, testing is handled similarly. Unlike with C++, the test registration
    mechanism and test driver are both provided by Rust itself.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Rust 中，测试的处理方式类似。与 C++ 不同，测试注册机制和测试驱动程序都是由 Rust 本身提供的。
- en: Additionally, the way that tests are organized is different. In C++, unit tests
    are defined in separate files from the units under test. In Rust, they are typically
    defined in the same file, usually in a `test` sub-module, with inclusion of the
    module controlled by the `test` feature flag via the `#[cfg(test)]` annotation.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，测试的组织方式也不同。在 C++ 中，单元测试是在被测试的单元之外单独定义的文件中定义的。在 Rust 中，它们通常在同一个文件中定义，通常在 `test`
    子模块中，模块的包含由 `test` 功能标志通过 `#[cfg(test)]` 注解控制。
- en: 'The example below defines a small class and tests for that class. In C++ this
    involves creating three separate files: a header file for the interface, the implementation
    of the interface, and the test driver. In Rust, this is all done in a single file.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的示例定义了一个小的类及其测试。在 C++ 中，这涉及到创建三个单独的文件：一个接口的头文件、接口的实现以及测试驱动程序。在 Rust 中，这一切都在一个文件中完成。
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '#![allow(unused)] fn main() { // counter.rs'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '#![allow(unused)] fn main() { // counter.rs'
- en: pub struct Counter(u32);
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: pub struct Counter(u32);
- en: impl Counter {
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: impl Counter {
- en: pub fn new() -> Counter {
  id: totrans-13
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: pub fn new() -> Counter {
- en: Counter(0)
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: Counter(0)
- en: '}'
  id: totrans-15
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: pub fn get(&self) -> u32 {
  id: totrans-16
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: pub fn get(&self) -> u32 {
- en: self.0
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: self.0
- en: '}'
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: pub fn increment(&mut self) {
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: pub fn increment(&mut self) {
- en: self.0 += 1;
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: self.0 += 1;
- en: '}'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '#[cfg(test)]'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '#[cfg(test)]'
- en: mod test {
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: mod test {
- en: use super::*;
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: use super::*;
- en: '#[test]'
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '#[test]'
- en: fn counter_initialize() {
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: fn counter_initialize() {
- en: let c = Counter::new();
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: let c = Counter::new();
- en: assert_eq!(0, c.get());
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: assert_eq!(0, c.get());
- en: '}'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: '#[test]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '#[test]'
- en: fn counter_increment() {
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: fn counter_increment() {
- en: let mut c = Counter::new();
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: let mut c = Counter::new();
- en: c.increment();
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: c.increment();
- en: assert_eq!(1, c.get());
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: assert_eq!(1, c.get());
- en: '}'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '[PRE2]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Defining unit tests within the module being tested has the benefit of making
    internals of the module under test visible to the test code. This makes it possible
    to unit test internal components without exposing them to the rest of the program,
    as one would have to in C++ by including declarations in the header file and by
    declaring test fixtures as `friend`s.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在被测试的模块内定义单元测试的好处是使被测试模块的内部结构对测试代码可见。这使得在不暴露给程序的其他部分的情况下（如在 C++ 中通过在头文件中包含声明并将测试固定点作为
    `friend` 声明）对内部组件进行单元测试成为可能。
- en: Running the tests in C++ involves linking against `boost_unit_test_framework`.
    In Rust, the tests can be run with `cargo test`. If not using Cargo, the tests
    can be compiled by passing the flag `--test` to rustc, and running the executable
    produced.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在 C++ 中运行测试涉及链接到 `boost_unit_test_framework`。在 Rust 中，可以使用 `cargo test` 运行测试。如果不使用
    Cargo，可以通过将标志 `--test` 传递给 rustc 来编译测试，并运行生成的可执行文件。
- en: '[Integration tests](#integration-tests)'
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[集成测试](#integration-tests)'
- en: Integration tests as supported by Cargo, are still defined outside of the module
    and outside of the crate, purely in terms of the exposed API.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: Cargo 支持的集成测试仍然是在模块外部和包外部定义的，纯粹基于暴露的 API。
- en: See the [Rust Book](https://doc.rust-lang.org/book/ch11-03-test-organization.html#integration-tests)
    for details on how to organize integration tests for Rust programs.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅[Rust 书籍](https://doc.rust-lang.org/book/ch11-03-test-organization.html#integration-tests)以了解如何为
    Rust 程序组织集成测试的详细信息。
- en: '[Click here to leave us feedback about this page.](https://docs.google.com/forms/d/e/1FAIpQLScoygeNlygODY2owQ-HvU8VGx3hi50aic7ZlKCyhJ0VktjiCg/viewform?usp=pp_url&entry.1450251950=Tests)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '[点击此处为此页面提供反馈](https://docs.google.com/forms/d/e/1FAIpQLScoygeNlygODY2owQ-HvU8VGx3hi50aic7ZlKCyhJ0VktjiCg/viewform?usp=pp_url&entry.1450251950=Tests)。'
